<!doctype html>
<meta charset="utf-8" />
<title>{{ app_title }}</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<style>
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 2rem; }
  h1 { margin-top: 0; }
  .recent { margin-top: 2rem; }
  .row { margin: .35rem 0; }
  .row a { margin-right: 1rem; }
  .muted { color:#666; font-size: .9rem; }
</style>

<h1>{{ app_title }}</h1>

<form method="post" action="/process" enctype="multipart/form-data" style="margin-bottom:2rem;">
  <div><strong>Original CSV</strong> <input type="file" name="original" required></div>
  <div style="margin-top:.5rem;">Additional CSVs (multi) <input type="file" name="others" multiple></div>

  <div style="margin-top:.5rem;">Tolerance (seconds) <input type="number" name="tolerance" value="5" style="width:5rem"></div>
  <div style="margin-top:.5rem;">Title <input type="text" name="title" value="CW Loop" style="width:20rem"></div>
  <div style="margin-top:.5rem;">Y1 Min <input type="number" step="any" name="y1_min" value="0" style="width:7rem"> 
       Y1 Max <input type="number" step="any" name="y1_max" value="100" style="width:7rem"></div>
  <div style="margin-top:.5rem;">Setpoint Column (optional) <input type="text" name="setpoint" placeholder="Active CW Flow Setpoint" style="width:20rem"></div>
  <div style="margin-top:.5rem;">Cutoff Datetime (optional) <input type="text" name="cutoff" placeholder="YYYY-MM-DD HH:MM:SS" style="width:20rem"></div>
  <div style="margin-top:.75rem;"><button type="submit">Process</button></div>
</form>

<div class="recent">
  <h2>Recent Exports</h2>
  {% if recents %}
    {% for r in recents %}
      <div class="row">
        <a href="{{ r.html_abs }}">View</a>
        <a href="{{ r.csv_abs }}" download>CSV</a>
        <span class="muted">— {{ r.title }} ({{ r.ts }}) — <a href="{{ r.day_abs }}">browse {{ r.day }}</a></span>
      </div>
    {% endfor %}
  {% else %}
    <div class="muted">No exports yet. Generate one above.</div>
  {% endif %}
</div>
